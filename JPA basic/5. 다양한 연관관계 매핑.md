# 다양한 연관관계 매핑

### 연관관계 매핑시 고려사항 3가지
- 다중성
- 단방향, 양방향
- 연관관계의 주인

## 다중성

### 다대일(N:1)
> 가장 많이 사용하는 연관관계이다. 다대일의 반대는 일대다이다.

#### 다대일 단방향
<img width="818" alt="image" src="https://user-images.githubusercontent.com/80378041/179196445-744b33f3-7304-46c8-8183-12bf9a661a4b.png">

#### 다대일 양방향
> 외래 키가 있는 쪽이 연관관계의 주인이다. 양쪽을 서로 참조할 수 있도록 개발되었다.     
<img width="828" alt="image" src="https://user-images.githubusercontent.com/80378041/179196498-88fbc4c0-b771-4ac7-b312-528036b65e37.png">

### 일대다(1:N)
> 실제로 많이 쓰이지는 않는다.      
#### 일대다 단방향
<img width="895" alt="image" src="https://user-images.githubusercontent.com/80378041/179196802-48283fdd-ab69-4ae1-af6f-d6a725011589.png">

- 일대다 단방향은 1:N에서 1이 연관관계의 주인이다.
- 테이블 일대다 관계는 항상 N쪽에 외래 키가 있다.
- 객체와 테이블의 차이 때문에 반대편 테이블의 외래 키를 관리하는 특이한 구조이다.
- 따라서 UPDATE 쿼리가 한번 더 발생하게 된다.

#### 일대다 양방향
<img width="982" alt="image" src="https://user-images.githubusercontent.com/80378041/179197183-cd85b88a-df0e-416a-8538-2399a0542587.png">

- 이런 매핑은 공식적으로 존재하지 않는다.
- 정 쓰고싶으면 `@JoinColumn`에 insertable, updatable 속성을 false로 지정해서 사용한다.

### 일대일(1:1)
> 일대일 관계는 그 반대도 일대일 관계이다.     
> 주 테이블이나 대상 테이블중에 외래 키를 선택해서 사용할 수 있다.     
> 이 때, 외래 키에 데이터베이스 유니크 제약조건을 걸어주는 것이 좋다.

#### 일대일 : 주 테이블에 외래 키 단방향
> 다대일 단방향과 매우 유사하다.     
<img width="856" alt="image" src="https://user-images.githubusercontent.com/80378041/179197633-55f53df5-7897-446a-8879-56ab09d7a527.png">

#### 일대일 : 주 테이블에 외래 키 양방향
> 다대일 양방향 매핑처럼 외래 키가 있는 곳이 연관관계의 주인이다.      
> 다대일 처럼 반대편엔 mappedBy 속성을 적용해준다.     
<img width="832" alt="image" src="https://user-images.githubusercontent.com/80378041/179197814-960b0502-d3cc-4b00-bee0-cdc0a106a5a5.png">

#### 일대일 : 대상 테이블에 외래 키 단방향
> 단방향 관계는 JPA에서 지원해주지 않는다.      
<img width="811" alt="image" src="https://user-images.githubusercontent.com/80378041/179198217-c586ac9e-efd3-4183-8c32-33f17c1a18b0.png">

#### 일대일 : 대상 테이블에 외래 키 양방향
> 일대일 주 테이블에 외래 키 양방향과 매핑 방법이 동일하다.      
<img width="840" alt="image" src="https://user-images.githubusercontent.com/80378041/179198348-cac5f0ee-814b-4b1e-8d48-fb24f99a0bbb.png">

#### 정리
- __주 테이블에 외래 키__
  - 주 객체가 대상 객체의 참조를 가지는 것 처럼 주 테이블에 외래 키를 두고 대상 테이블을 찾는다.
  - 객체지향 개발자가 선호하는 방식이다.
  - JPA 매핑이 편리하다.
  - 장점 : 주 테이블만 조회해도 대상 테이블에 데이터가 있는지 확인할 수 있다.
  - 단점 : 값이 없으면 외래 키에 null을 허용한다.
- __대상 테이블에 외래 키__
  - 대상 테이블에 외래 키가 존재한다.
  - 전통적인 DB 개발자가 선호하는 방식이다.
  - 장점 : 주 테이블과 대상 테이블을 일대일에서 일대다 관계로 변경할 때 테이블의 구조를 유지할 수 있다.
  - 단점 : 프록시 기능의 한계로 지연로딩이 불가능하다.

### 다대다(N:N)
> 관계형 DB는 정규화된 테이블 2개로 다대다 관계를 표현할 수 없다.      
> 연결 테이블을 추가해서 일대다, 다대일 관계로 풀어내야 한다.

<img width="887" alt="image" src="https://user-images.githubusercontent.com/80378041/179199025-12e43821-13dc-41af-b430-92ff307da464.png">

#### 한계
- 편리해 보이지만, 실무에서 사용하면 안된다.
- 연결 테이블이 단순히 연결만 하고 끝나는 것이 아니다.
- 주문시간, 수량같은 데이터가 들어올 수 있다.



