# 프록시
> <img width="1036" alt="image" src="https://user-images.githubusercontent.com/80378041/179669719-163ec705-be74-46e5-9b9b-133c24f49420.png">      
> Member를 조회할 때, Team도 함께 조회해야 할까?      

__멤버와 Team 모두 출력__
```java
public void printUserAndTeam(String memberId) {
Member member = em.find(Member.class, memberId);
Team team = member.getTeam();
System.out.println("회원 이름: " + member.getUsername());
System.out.println("소속팀: " + team.getName()); }
```
__멤버만 출력__
```java
public void printUser(String memberId) { 
Member member = em.find(Member.class, memberId); 
Team team = member.getTeam(); 
System.out.println("회원 이름: " + member.getUsername());
}
```

어떤 경우에는 member와 Team을 같이 사용하지만, 어떤 경우에는 member만 사용하는 경우도 있다.      
이럴 때, member만 사용하는데 Team을 같이 가져오면, 낭비가 발생하게 된다!     

## 프록시 기초
> __em.find() vs em.getReference()__      
> em.find()를 하면 바로 조회 쿼리가 날아가고, 실제 엔티티 객체를 조회해오지만,      
> em.getReference()를 하면 데이터 조회를 미루고, 가짜(프록시) 엔티티 객체를 조회해온다.

<img width="751" alt="image" src="https://user-images.githubusercontent.com/80378041/179670451-f35915fa-8ba9-4f31-a372-89a92fc8ee0f.png">

__getReference()로 불러온 값은, 실제로 엔티티의 정보를 사용하려 할 때 조회 쿼리를 날려서 가짜 엔티티 객체를 채운다!__

## 프록시 특징
> 프록시 객체는 실제 객체의 참조(target)을 보관한다.      
> 프록시 객체를 호출하면, 프록시 객체는 실제 객체의 메서드를 호출하게 된다.

<img width="888" alt="image" src="https://user-images.githubusercontent.com/80378041/179671404-23f41de7-8a8d-41bf-acee-ecd3c7d4e123.png">

- 프록시 객체는 처음 사용할 때 한번만 초기화(쿼리를 2번 날리지는 않는다)
- 프록시 객체를 초기화할 때, 프록시 객체가 실제 엔티티로 바뀌는 것은 아니다. 초기화되면 프록시 객체를 통해서 실제 엔티티에 접근하는 것이다.
- 프록시 객체는 원본 엔티티를 상속받고, 따라서 타입 체크시 주의해야 함(원본.class == 프록시.class -> false가 된다)
- 영속성 컨텍스트에 찾고자 하는 엔티티가 이미 있으면, getReference()를 통해 호출해도 실제 엔티티가 반환이 된다.
- 영속성 컨텍스트의 도움을 받을 수 없는 준영속 상태일 때, 프록시를 초기화하면 오류가 발생한다.


### 프록시 객체의 초기화
```java
Member member = em.getReference(Member.class, "id1");
member.getName();
```
위의 코드로 프록시 객체를 만들고, getName()으로 member의 이름을 조회하면 아래와 같이 동작한다.     
<img width="947" alt="image" src="https://user-images.githubusercontent.com/80378041/179671637-9153d1c2-e1a7-44de-8e37-04cbb92fb92f.png">


